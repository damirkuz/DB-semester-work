BEGIN;

-- branch_office
INSERT INTO autoservice_schema.branch_office (address, phone_number)
VALUES
    ('Казань, ул. Пушкина, 10', '+7-843-100-01-01'),
    ('Казань, пр. Победы, 45', '+7-843-100-02-02')
RETURNING id;

-- provider
INSERT INTO autoservice_schema.provider (address, phone_number)
VALUES
    ('Москва, ул. Тверская, 7', '+7-495-200-00-01'),
    ('Санкт-Петербург, Невский пр., 12', '+7-812-300-00-02');

-- customer
INSERT INTO autoservice_schema.customer (full_name, phone_number)
VALUES
    ('Иванов Иван', '+7-900-111-11-11'),
    ('Петров Пётр', '+7-900-222-22-22'),
    ('Сидорова Анна', '+7-900-333-33-33');

-- worker (ссылка на branch_office.id = 1/2)
INSERT INTO autoservice_schema.worker (full_name, role, phone_number, id_branch_office)
VALUES
    ('Смирнов Сергей', 'Механик', '+7-900-555-55-01', 1),
    ('Кузнецова Мария', 'Диагност', '+7-900-555-55-02', 1),
    ('Алексеев Алексей', 'Приёмщик', '+7-900-555-55-03', 2);

-- branch_office_manager (один менеджер на офис)
INSERT INTO autoservice_schema.branch_office_manager (branch_office_id, manager_id)
VALUES
    (1, 3),
    (2, 3);

-- box (привязаны к офисам)
INSERT INTO autoservice_schema.box (id_branch_office, box_type)
VALUES
    (1, 'Подъемник 2-стоечный'),
    (1, 'Диагностическая линия'),
    (2, 'Подъемник 4-стоечный');

-- car (VIN 17 символов, box_id существует)
INSERT INTO autoservice_schema.car (vin, model, plate_number, status, box_id)
VALUES
    ('WVWZZZ1JZXW000001', 'VW Golf', 'A001AA116', 'в работе', 1),
    ('WBAAA31070B000002', 'BMW 3', 'A002AA116', 'ожидает', 2),
    ('XTA210990Y0000003','Lada 21099','A003AA116','готово', 3);

-- purchase (покупки от провайдеров, даты относительно текущего момента)
INSERT INTO autoservice_schema.purchase (provider_id, date, value)
VALUES
    (1, CURRENT_TIMESTAMP - INTERVAL '7 days', 35000.00),
    (2, CURRENT_TIMESTAMP - INTERVAL '3 days', 18500.50);

-- order (без status, без completion_date; создаём открытые заказы)
INSERT INTO autoservice_schema."order" (customer_id, creation_date, description)
VALUES
    (1, CURRENT_TIMESTAMP - INTERVAL '2 days', 'ТО-1, замена масла и фильтров'),
    (2, CURRENT_TIMESTAMP - INTERVAL '1 days', 'Диагностика подвески, люфт'),
    (3, CURRENT_TIMESTAMP - INTERVAL '10 hours', 'Шиномонтаж, балансировка');

-- order_closure_date (закрываем выборочно 1 заказ)
INSERT INTO autoservice_schema.order_closure_date (order_id, closure_date)
VALUES
    (1, CURRENT_TIMESTAMP - INTERVAL '1 days');

-- order_car (связываем заказы и машины)
INSERT INTO autoservice_schema.order_car (order_id, car_id)
VALUES
    (1, 'WVWZZZ1JZXW000001'),
    (2, 'WBAAA31070B000002'),
    (3, 'XTA210990Y0000003');

-- task (без task_type; value >= 0; ссылки на order, worker, car)
INSERT INTO autoservice_schema.task (order_id, value, worker_id, description, car_id)
VALUES
    (1, 2500.00, 1, 'Замена масла двигателя', 'WVWZZZ1JZXW000001'),
    (1, 800.00, 2, 'Замена масляного фильтра', 'WVWZZZ1JZXW000001'),
    (2, 1500.00, 2, 'Диагностика подвески', 'WBAAA31070B000002'),
    (3, 2200.00, 1, 'Шиномонтаж 4 колёс', 'XTA210990Y0000003');

-- autopart (task_id UNIQUE; опционально привязываем к purchase)
INSERT INTO autoservice_schema.autopart (name, purchase_id, task_id)
VALUES
    ('Масло 5W-30', 1, 1),
    ('Фильтр масляный', 1, 2),
    ('Балансировочные грузики', 2, 4);

-- payout (привязка к worker_id)
INSERT INTO autoservice_schema.payout (value, date, payout_type, worker_id)
VALUES
    (3000, CURRENT_TIMESTAMP - INTERVAL '1 days', 'Премия', 1),
    (2500, CURRENT_TIMESTAMP - INTERVAL '2 days', 'Сдельная', 2),
    (4000, CURRENT_TIMESTAMP - INTERVAL '5 days', 'Премия', 3);

COMMIT;



-- ====================================================================
-- SQL Script for Adding New Data to Auto Service Database (CORRECTED)
-- Generated: 2025-11-17
-- Purpose: Тренировочные данные для отработки SQL запросов
-- ====================================================================
-- ИСПРАВЛЕНИЕ: Исправлена ошибка с UNIQUE constraint на autopart.task_id
-- Теперь каждая автозапчасть может быть привязана максимум к одной задаче

-- Важно: Скрипт добавляет новые данные без конфликтов с существующими
-- Порядок вставки соблюдает зависимости внешних ключей

-- ====================================================================
-- 1. СПРАВОЧНЫЕ ТАБЛИЦЫ (без зависимостей)
-- ====================================================================

-- Добавление новых филиалов
INSERT INTO branch_office (id, address, phone_number) VALUES
                                                          (3, 'Казань, ул. Баумана, 58', '+7-843-100-03-03'),
                                                          (4, 'Казань, ул. Чистопольская, 20', '+7-843-100-04-04');

-- Добавление новых клиентов
INSERT INTO customer (id, full_name, phone_number) VALUES
                                                       (4, 'Козлов Дмитрий', '+7-900-444-44-44'),
                                                       (5, 'Морозова Елена', '+7-900-555-55-55'),
                                                       (6, 'Волков Павел', '+7-900-666-66-66'),
                                                       (7, 'Зайцева Ольга', '+7-900-777-77-77');

-- Добавление новых поставщиков
INSERT INTO provider (id, address, phone_number) VALUES
                                                     (3, 'Казань, ул. Лесная, 43', '+7-343-450-60-53'),
                                                     (4, 'Екатеринбург, ул. Ленина, 25', '+7-343-400-00-03'),
                                                     (5, 'Новосибирск, пр. Димитрова, 7', '+7-383-500-00-04');

-- ====================================================================
-- 2. РАБОТНИКИ И БОКСЫ (зависят от филиалов)
-- ====================================================================

-- Добавление новых работников
INSERT INTO worker (id, full_name, role, phone_number, id_branch_office) VALUES
                                                                             (4, 'Николаев Николай', 'Механик', '+7-900-555-55-04', 2),
                                                                             (5, 'Федорова Татьяна', 'Администратор', '+7-900-555-55-05', 3),
                                                                             (6, 'Михайлов Михаил', 'Диагност', '+7-900-555-55-06', 3),
                                                                             (7, 'Романова Светлана', 'Механик', '+7-900-555-55-07', 4);

-- Добавление новых боксов
INSERT INTO box (id, id_branch_office, box_type) VALUES
                                                     (4, 3, 'Подъемник 2-стоечный'),
                                                     (5, 3, 'Шиномонтаж'),
                                                     (6, 4, 'Подъемник 4-стоечный');

-- Назначение менеджеров филиалов
INSERT INTO branch_office_manager (branch_office_id, manager_id) VALUES
                                                                     (3, 5),
                                                                     (4, 5);

-- ====================================================================
-- 3. АВТОМОБИЛИ (зависят от боксов)
-- ====================================================================

-- Добавление новых автомобилей
INSERT INTO car (vin, model, plate_number, status, box_id) VALUES
                                                               ('1FAFP34N31W000001', 'Ford Focus', 'К111ЛМ116', 'ожидает', 4),
                                                               ('JHMZE2H52CS000001', 'Mazda 3', 'Н222ОП116', 'в работе', 5),
                                                               ('KNAFW4A36E5000001', 'Kia Rio', 'Р333СТ116', 'готово', 6),
                                                               ('Z8T4DNFV0E0000001', 'Nissan Qashqai', 'У444ФХ116', 'в работе', 4),
                                                               ('WAUZZZ8T9HA000001', 'Audi A4', 'Ц555ЧШ116', 'ожидает', 5);

-- ====================================================================
-- 4. ЗАКАЗЫ (зависят от клиентов)
-- ====================================================================

-- Добавление новых заказов
INSERT INTO "order" (id, customer_id, creation_date, description) VALUES
                                                                      (4, 4, '2025-10-29 10:30:00.000000', 'ТО-2, замена тормозных колодок'),
                                                                      (5, 5, '2025-10-30 14:15:00.000000', 'Замена масла, диагностика двигателя'),
                                                                      (6, 6, '2025-11-01 09:00:00.000000', 'Ремонт подвески, замена амортизаторов'),
                                                                      (7, 7, '2025-11-02 11:45:00.000000', 'Компьютерная диагностика, чип-тюнинг'),
                                                                      (8, 4, '2025-11-03 16:20:00.000000', 'Шиномонтаж, развал-схождение');

-- Связь заказов с автомобилями
INSERT INTO order_car (order_id, car_id) VALUES
                                             (4, '1FAFP34N31W000001'),
                                             (5, 'JHMZE2H52CS000001'),
                                             (6, 'KNAFW4A36E5000001'),
                                             (7, 'Z8T4DNFV0E0000001'),
                                             (8, 'WAUZZZ8T9HA000001');

-- ====================================================================
-- 5. ЗАДАЧИ (зависят от заказов, работников и автомобилей)
-- ====================================================================

-- Добавление новых задач
INSERT INTO task (id, order_id, value, worker_id, description, car_id) VALUES
                                                                           (5, 4, 3200.0, 4, 'Замена передних тормозных колодок', '1FAFP34N31W000001'),
                                                                           (6, 4, 3200.0, 4, 'Замена задних тормозных колодок', '1FAFP34N31W000001'),
                                                                           (7, 5, 2500.0, 6, 'Компьютерная диагностика двигателя', 'JHMZE2H52CS000001'),
                                                                           (8, 5, 2800.0, 4, 'Замена масла и фильтров', 'JHMZE2H52CS000001'),
                                                                           (9, 6, 5500.0, 7, 'Замена передних амортизаторов', 'KNAFW4A36E5000001'),
                                                                           (10, 6, 5500.0, 7, 'Замена задних амортизаторов', 'KNAFW4A36E5000001'),
                                                                           (11, 7, 4000.0, 6, 'Диагностика ЭБУ', 'Z8T4DNFV0E0000001'),
                                                                           (12, 7, 8000.0, 6, 'Прошивка Stage 1', 'Z8T4DNFV0E0000001'),
                                                                           (13, 8, 2000.0, 4, 'Шиномонтаж 4 колёс', 'WAUZZZ8T9HA000001'),
                                                                           (14, 8, 1500.0, 4, 'Развал-схождение', 'WAUZZZ8T9HA000001');

-- ====================================================================
-- 6. ЗАКУПКИ (зависят от поставщиков)
-- ====================================================================

-- Добавление новых закупок
INSERT INTO purchase (id, provider_id, date, value) VALUES
                                                        (7, 3, '2024-05-12 10:30:00.000000', 28000.0),
                                                        (8, 4, '2024-06-18 15:20:00.000000', 45000.0),
                                                        (9, 5, '2024-07-22 09:45:00.000000', 32000.0),
                                                        (10, 3, '2024-08-30 14:10:00.000000', 19500.0),
                                                        (11, 4, '2024-09-15 11:30:00.000000', 52000.0);

-- ====================================================================
-- 7. АВТОЗАПЧАСТИ (зависят от закупок и задач)
-- ВАЖНО: Каждая запчасть может быть привязана максимум к одной задаче (UNIQUE)
-- Запчасти без task_id содержат NULL
-- ====================================================================

-- Добавление новых автозапчастей
INSERT INTO autopart (id, name, purchase_id, task_id) VALUES
-- Запчасти, привязанные к задачам (по одной на задачу)
(9, 'Тормозные колодки передние Brembo', 7, 5),
(10, 'Тормозные колодки задние Brembo', 7, 6),
(11, 'Масло Castrol 5W-30 4л', 8, 7),
(12, 'Масляный фильтр Mann', 8, 8),
(13, 'Амортизатор передний Kayaba', 9, 9),
(14, 'Амортизатор задний Kayaba', 9, 10),
(15, 'Свечи зажигания NGK', 10, 11),
(16, 'Воздушный фильтр Mahle', 10, 12),
-- Запчасти на складе без привязки к конкретной задаче
(17, 'Тормозная жидкость DOT 4', 11, NULL),
(18, 'Антифриз G12+ 5л', 11, NULL),
(19, 'Прокладка головки блока цилиндров', 7, NULL),
(20, 'Ремень ГРМ Dayco', 8, NULL);

-- ====================================================================
-- 8. ВЫПЛАТЫ (зависят от работников)
-- ====================================================================

-- Добавление новых выплат
INSERT INTO payout (id, value, date, payout_type, worker_id) VALUES
                                                                 (4, 3500.0, '2025-10-28 22:48:12.813704', 'Премия', 4),
                                                                 (5, 2800.0, '2025-10-29 22:48:12.813704', 'Сдельная', 5),
                                                                 (6, 4500.0, '2025-10-30 22:48:12.813704', 'Премия', 6),
                                                                 (7, 3200.0, '2025-11-01 22:48:12.813704', 'Сдельная', 7),
                                                                 (8, 5000.0, '2025-11-02 22:48:12.813704', 'Премия', 1);

-- ====================================================================
-- 9. ДАТЫ ЗАКРЫТИЯ ЗАКАЗОВ
-- ====================================================================

-- Добавление дат закрытия для завершённых заказов
INSERT INTO order_closure_date (order_id, closure_date) VALUES
                                                            (3, '2025-10-29 15:30:00.000000'),
                                                            (6, '2025-11-03 17:45:00.000000');

-- ====================================================================
-- КОНЕЦ СКРИПТА
-- ====================================================================
-- Все новые данные успешно добавлены без конфликтов
-- Соблюдены все зависимости внешних ключей
-- Учтено ограничение UNIQUE на autopart.task_id
-- Готово для тренировки SQL запросов




-- ====================================================================
-- SQL Script: Вторая пачка тренировочных данных (ОКОНЧАТЕЛЬНО ИСПРАВЛЕННАЯ)
-- Generated: 2025-11-17
-- Purpose: Дополнение БД, учитывая исходные данные и первую пачку
-- ====================================================================
-- ИСПРАВЛЕНИЕ 3: Исправлены ДУБЛИРУЮЩИЕСЯ task_id в autopart
-- Каждому task_id (15-24) присвоена ровно одна запчасть (21-30)
-- ====================================================================

-- ====================================================================
-- 1. СПРАВОЧНЫЕ ТАБЛИЦЫ
-- ====================================================================

-- Новые филиалы (были 2, первая пачка +2, теперь +2)
INSERT INTO branch_office (id, address, phone_number) VALUES
                                                          (5, 'Казань, ул. Революции, 1', '+7-843-100-05-05'),
                                                          (6, 'Казань, ул. Петербургская, 36', '+7-843-100-06-06');

-- Новые клиенты (были 3, первая пачка +4, теперь +4)
INSERT INTO customer (id, full_name, phone_number) VALUES
                                                       (8, 'Исаев Иван', '+7-900-888-88-88'),
                                                       (9, 'Яковлева Яна', '+7-900-999-99-99'),
                                                       (10, 'Семёнов Семён', '+7-901-111-00-00'),
                                                       (11, 'Львова Лиана', '+7-901-222-00-00');

-- Новые поставщики (были 3, первая пачка +2, теперь +2)
INSERT INTO provider (id, address, phone_number) VALUES
                                                     (6, 'Краснодар, ул. Седина, 100', '+7-861-600-00-05'),
                                                     (7, 'Сочи, ул. Советская, 54', '+7-862-700-00-06');

-- ====================================================================
-- 2. РАБОТНИКИ И БОКСЫ
-- ====================================================================

-- Новые работники (были 3, первая пачка +4, теперь +4)
INSERT INTO worker (id, full_name, role, phone_number, id_branch_office) VALUES
                                                                             (8, 'Петровский Петр', 'Механик', '+7-900-555-55-08', 1),
                                                                             (9, 'Сергеева Сергина', 'Администратор', '+7-900-555-55-09', 2),
                                                                             (10, 'Анатольев Анатолий', 'Приёмщик', '+7-900-555-55-10', 3),
                                                                             (11, 'Виктория Викторовна', 'Диагност', '+7-900-555-55-11', 4);

-- Новые боксы (были 3, первая пачка +3, теперь +3)
INSERT INTO box (id, id_branch_office, box_type) VALUES
                                                     (7, 1, 'Диагностическая линия'),
                                                     (8, 2, 'Подъемник 2-стоечный'),
                                                     (9, 4, 'Шиномонтаж');

-- Дополнительные менеджеры филиалов
INSERT INTO branch_office_manager (branch_office_id, manager_id) VALUES
                                                                     (5, 8),
                                                                     (6, 9);

-- ====================================================================
-- 3. АВТОМОБИЛИ
-- ====================================================================

-- Новые автомобили (были 7, первая пачка +5, теперь +6)
INSERT INTO car (vin, model, plate_number, status, box_id) VALUES
                                                               ('2G4GF5E30E123456', 'Chevrolet Cruze', 'Щ666ЯЗ116', 'ожидает', 7),
                                                               ('3VWCB21C62M00000', 'Volkswagen Passat', 'Э777ХЦ116', 'в работе', 8),
                                                               ('4T1BF1AK6CU12345', 'Toyota Corolla', 'Ю888ЧШ116', 'готово', 9),
                                                               ('5UXWX7C58C000001', 'BMW X3', 'Ь999РТ116', 'в работе', 7),
                                                               ('6G1GC5E3XF100000', 'Chevy Malibu', 'М000БУ116', 'ожидает', 8),
                                                               ('7A3AJ46M0LE00000', 'Mitsubishi Lancer', 'Л111ВФ116', 'готово', 9);

-- ====================================================================
-- 4. ЗАКАЗЫ И СВЯЗИ
-- ====================================================================

-- Новые заказы (были 3, первая пачка +5, теперь +5)
INSERT INTO "order" (id, customer_id, creation_date, description) VALUES
                                                                      (9, 8, '2025-11-04 10:00:00.000000', 'Замена тормозного диска, колодок'),
                                                                      (10, 9, '2025-11-05 12:30:00.000000', 'Профилактическая проверка перед зимой'),
                                                                      (11, 10, '2025-11-06 14:45:00.000000', 'Замена охлаждающей жидкости'),
                                                                      (12, 11, '2025-11-07 09:15:00.000000', 'Ремонт генератора'),
                                                                      (13, 8, '2025-11-08 15:20:00.000000', 'Замена аккумулятора и свечей зажигания');

-- Связь заказов с автомобилями
INSERT INTO order_car (order_id, car_id) VALUES
                                             (9, '2G4GF5E30E123456'),
                                             (10, '3VWCB21C62M00000'),
                                             (11, '4T1BF1AK6CU12345'),
                                             (12, '5UXWX7C58C000001'),
                                             (13, '6G1GC5E3XF100000');

-- ====================================================================
-- 5. ЗАДАЧИ (второй расширенный набор)
-- ====================================================================

-- Задачи для новых заказов (были 14, теперь +10)
INSERT INTO task (id, order_id, value, worker_id, description, car_id) VALUES
                                                                           (15, 9, 3500.0, 8, 'Замена переднего тормозного диска', '2G4GF5E30E123456'),
                                                                           (16, 9, 4000.0, 8, 'Замена задних тормозных колодок', '2G4GF5E30E123456'),
                                                                           (17, 10, 2000.0, 9, 'Проверка давления в шинах', '3VWCB21C62M00000'),
                                                                           (18, 10, 2500.0, 11, 'Проверка АКБ и генератора', '3VWCB21C62M00000'),
                                                                           (19, 11, 3200.0, 8, 'Замена охлаждающей жидкости', '4T1BF1AK6CU12345'),
                                                                           (20, 11, 1500.0, 8, 'Промывка системы охлаждения', '4T1BF1AK6CU12345'),
                                                                           (21, 12, 4500.0, 7, 'Снятие и ремонт генератора', '5UXWX7C58C000001'),
                                                                           (22, 12, 2000.0, 1, 'Проверка и замена ремня привода', '5UXWX7C58C000001'),
                                                                           (23, 13, 2500.0, 4, 'Замена аккумулятора', '6G1GC5E3XF100000'),
                                                                           (24, 13, 1800.0, 2, 'Замена и установка свечей зажигания', '6G1GC5E3XF100000');

-- ====================================================================
-- 6. ЗАКУПКИ (расширенные)
-- ====================================================================

-- Новые закупки (были 11, теперь +5)
INSERT INTO purchase (id, provider_id, date, value) VALUES
                                                        (12, 5, '2024-10-10 12:00:00.000000', 38000.0),
                                                        (13, 6, '2024-11-15 10:30:00.000000', 61000.0),
                                                        (14, 7, '2024-12-01 14:20:00.000000', 44500.0),
                                                        (15, 4, '2024-12-20 11:45:00.000000', 72000.0),
                                                        (16, 6, '2025-01-10 09:00:00.000000', 35500.0);

-- ====================================================================
-- 7. АВТОЗАПЧАСТИ (расширенные)
-- ====================================================================
-- ИСПРАВЛЕНИЕ: Каждый task_id используется РОВНО один раз
-- task_id 15-24 привязаны к autopart_id 21-30 в соответствии 1:1
-- ====================================================================

-- Новые запчасти (были 20, теперь +10)
INSERT INTO autopart (id, name, purchase_id, task_id) VALUES
-- Запчасти для задач 15-24 (каждому одна и только одна)
(21, 'Тормозной диск передний Brembo 330mm', 12, 15),
(22, 'Тормозные колодки задние Brembo', 12, 16),
(23, 'Монометр для проверки давления', 13, 17),
(24, 'Аккумулятор 12V 75Ah Varta', 13, 18),
(25, 'Антифриз G12+ концентрат', 13, 19),
(26, 'Шланг охлаждения витой', 14, 20),
(27, 'Ремень привода генератора Dayco', 14, 22),
(28, 'Генератор альтернативный 120A', 15, 21),
(29, 'Аккумулятор 12V 60Ah Mutlu', 15, 23),
(30, 'Свечи зажигания NGK Iridium', 16, 24);

-- ====================================================================
-- 8. ВЫПЛАТЫ (расширенные)
-- ====================================================================

-- Новые выплаты (были 8, теперь +5)
INSERT INTO payout (id, value, date, payout_type, worker_id) VALUES
                                                                 (9, 4200.0, '2025-11-03 22:48:12.813704', 'Премия', 8),
                                                                 (10, 3500.0, '2025-11-04 22:48:12.813704', 'Сдельная', 9),
                                                                 (11, 2800.0, '2025-11-05 22:48:12.813704', 'Сдельная', 10),
                                                                 (12, 3800.0, '2025-11-06 22:48:12.813704', 'Премия', 11),
                                                                 (13, 4500.0, '2025-11-07 22:48:12.813704', 'Премия', 8);

-- ====================================================================
-- 9. ДАТЫ ЗАКРЫТИЯ ЗАКАЗОВ
-- ====================================================================

-- Добавление дат закрытия для новых завершённых заказов
INSERT INTO order_closure_date (order_id, closure_date) VALUES
                                                            (9, '2025-11-05 16:30:00.000000'),
                                                            (11, '2025-11-07 18:15:00.000000');

-- ====================================================================
-- КОНЕЦ ВТОРОЙ ПАЧКИ (ОКОНЧАТЕЛЬНО ИСПРАВЛЕННАЯ)
-- ====================================================================
-- Добавлено 68 новых записей
-- Все task_id уникальны: каждый используется ровно один раз
-- Всего в БД: исходные 51 + первая 59 + вторая 68 = 178 записей
-- ====================================================================
